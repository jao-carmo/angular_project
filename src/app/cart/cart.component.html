<div class="cart-wrapper">
  <!-- Animated background -->
  <div class="animated-bg">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
  </div>

  <div class="cart-container">
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-left">
        <button mat-icon-button routerLink="/products" class="back-button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="header-title">
          <h1>üõí Meu Carrinho</h1>
          <p class="subtitle">{{ items.length }} {{ items.length === 1 ? 'item' : 'itens' }} no carrinho</p>
        </div>
      </div>
      <button mat-stroked-button (click)="continueShopping()" class="continue-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Continuar Comprando
      </button>
    </div>

    <!-- Cart Content -->
    <div class="cart-content" *ngIf="items.length > 0">
      <div class="cart-items">
        <!-- Cart Items List -->
        <div class="item-card" *ngFor="let item of items; let i = index" [style.animation-delay]="(i * 0.05) + 's'">
          <div class="item-image">
            <img [src]="item.product.imageUrl || 'https://via.placeholder.com/80?text=Sem+Imagem'" 
                 [alt]="item.product.name"
                 (error)="onImageError($event)">
          </div>
          
          <div class="item-details">
            <h3 class="item-name">{{ item.product.name }}</h3>
            <p class="item-description">{{ item.product.description || 'Sem descri√ß√£o' }}</p>
            <p class="item-price-unit">{{ item.product.price | currency:'BRL' }} cada</p>
          </div>

          <div class="item-quantity">
            <button mat-icon-button (click)="decrement(item.product.id!)" [disabled]="item.quantity <= 1" class="qty-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
            <span class="quantity">{{ item.quantity }}</span>
            <button mat-icon-button (click)="increment(item.product.id!)" class="qty-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>

          <div class="item-total">
            <p class="total-label">Total</p>
            <p class="total-value">{{ item.product.price * item.quantity | currency:'BRL' }}</p>
          </div>

          <button mat-icon-button (click)="removeItem(item.product.id!)" class="remove-btn" matTooltip="Remover item">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="order-summary">
        <div class="summary-card">
          <h2>Resumo do Pedido</h2>

          <!-- CEP Section -->
          <div class="cep-section">
            <h3>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
              Calcular Frete
            </h3>
            
            <div class="cep-input-group">
              <input 
                type="text" 
                [(ngModel)]="cep"
                (input)="formatCep($event)"
                placeholder="00000-000"
                maxlength="9"
                class="cep-input"
              />
              <button mat-raised-button color="primary" (click)="calculateShipping()" [disabled]="loadingCep" class="cep-btn">
                <mat-spinner *ngIf="loadingCep" diameter="20"></mat-spinner>
                <span *ngIf="!loadingCep">Calcular</span>
              </button>
            </div>
            
            <p class="cep-error" *ngIf="cepError">{{ cepError }}</p>

            <!-- Shipping Info -->
            <div class="shipping-info" *ngIf="shipping">
              <div class="shipping-address">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>{{ shipping.address }}</span>
              </div>
              <div class="shipping-city">
                {{ shipping.city }} - {{ shipping.state }}
              </div>
            </div>
          </div>

          <!-- Summary Values -->
          <div class="summary-values">
            <div class="summary-row">
              <span>Subtotal</span>
              <span>{{ subtotal | currency:'BRL' }}</span>
            </div>
            
            <div class="summary-row shipping-row">
              <span>Frete</span>
              <span *ngIf="!shipping" class="shipping-pending">Calcule o CEP</span>
              <span *ngIf="shipping && isFreeShipping" class="free-shipping">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                GR√ÅTIS
              </span>
              <span *ngIf="shipping && !isFreeShipping">{{ shippingCost | currency:'BRL' }}</span>
            </div>

            <div class="free-shipping-banner" *ngIf="!isFreeShipping">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <span>Faltam <strong>{{ 100 - subtotal | currency:'BRL' }}</strong> para frete gr√°tis!</span>
            </div>

            <div class="free-shipping-banner success" *ngIf="isFreeShipping">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>Voc√™ ganhou <strong>frete gr√°tis!</strong></span>
            </div>

            <div class="summary-row total-row">
              <span>Total</span>
              <span class="total-value">{{ total | currency:'BRL' }}</span>
            </div>
          </div>

          <!-- Checkout Button -->
          <button mat-raised-button color="primary" (click)="goToCheckout()" class="checkout-btn" [disabled]="!shipping">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM20 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Finalizar Compra
          </button>
        </div>
      </div>
    </div>

    <!-- Empty Cart State -->
    <div class="empty-cart" *ngIf="items.length === 0">
      <div class="empty-icon">
        <svg width="120" height="120" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2zM20 20a1 1 0 1 0 0 2 1 1 0 0 0 0-2z" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <defs>
            <linearGradient id="gradient" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
              <stop stop-color="#667eea"/>
              <stop offset="1" stop-color="#764ba2"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <h2>Seu carrinho est√° vazio</h2>
      <p>Adicione produtos ao carrinho para continuar comprando</p>
      <button mat-raised-button color="primary" routerLink="/products" class="empty-action-btn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Ver Produtos
      </button>
    </div>
  </div>
</div>
